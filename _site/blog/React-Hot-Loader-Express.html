<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="breuer.dev" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="breuer.dev" /> <title> React.js with ES6 &amp; Webpack 4 =&gt; React-Hot-Loader 4 as Middleware with Express 4 - breuer.dev </title> <link rel="alternate" href="http://localhost:4000/blog/React-Hot-Loader-Express" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/blog/React-Hot-Loader-Express" /> <meta name="description" content="learning by doing" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="React.js with ES6 &amp; Webpack 4 =&gt; React-Hot-Loader 4 as Middleware with Express 4 | Felix Breuer" /> <meta property="og:title" content="React.js with ES6 &amp; Webpack 4 =&gt; React-Hot-Loader 4 as Middleware with Express 4 | Felix Breuer" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/blog/React-Hot-Loader-Express" /> <meta property="og:description" content="learning by doing" /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="React.js with ES6 &amp; Webpack 4 =&gt; React-Hot-Loader 4 as Middleware with Express 4 | felix_breuer" /> <meta name="twitter:url" content="http://localhost:4000/blog/React-Hot-Loader-Express" /> <meta name="twitter:site" content="@felix_breuer" /> <meta name="twitter:creator" content="@felix_breuer" /> <meta name="twitter:description" content="learning by doing" /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="breuer.dev" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#javascript">JAVASCRIPT</a>, <a class="tag" href="/tags/#js">JS</a>, <a class="tag" href="/tags/#node">NODE</a>, <a class="tag" href="/tags/#express">EXPRESS</a>, <a class="tag" href="/tags/#server">SERVER</a>, <a class="tag" href="/tags/#client">CLIENT</a>, <a class="tag" href="/tags/#react">REACT</a>, <a class="tag" href="/tags/#react-hot-loader">REACT-HOT-LOADER</a>, <a class="tag" href="/tags/#middleware">MIDDLEWARE</a>, <a class="tag" href="/tags/#es6">ES6</a> </span> </div> <h1 class="header-title" itemprop="headline">React.js with ES6 &amp; Webpack 4 =&gt; React-Hot-Loader 4 as Middleware with Express 4</h1> <div class="post-meta"> <time datetime="2018-05-23T12:00:00+02:00" itemprop="datePublished"> May 23, 2018 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Felix Breuer</span> </span> <time hidden datetime="" itemprop="dateModified"> May 23, 2018 </time> <span hidden itemprop="publisher" itemtype="Person">Felix Breuer</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p>To start a tiny <a href="https://reactjs.org">react-app</a> (with the new <a href="http://es6-features.org/">ES6</a> features) I wanted to have a basic <a href="https://github.com/gaearon/react-hot-loader">hot-reload</a> development server with an <a href="http://expressjs.com/">expressJS</a> backend server, to handle API calls in the future.<br /> This should be bundled with <a href="https://webpack.js.org">webpack</a> because it’s the most popular and kinda easy to handle react in my opinion.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>To start a tiny <a href="https://reactjs.org">react-app</a> (with the new <a href="http://es6-features.org/">ES6</a> features) I wanted to have a basic <a href="https://github.com/gaearon/react-hot-loader">hot-reload</a> development server with an <a href="http://expressjs.com/">expressJS</a> backend server, to handle API calls in the future.<br /> This should be bundled with <a href="https://webpack.js.org">webpack</a> because it’s the most popular and kinda easy to handle react in my opinion.</p> <p>Since I couldn’t find any good documentation on the internet, I decided to put all of this together with the newest versions out there in 2018.<!--more--></p> <p>Many react apps are created with <a href="https://github.com/facebook/create-react-app">create-react-app</a> nowadays. This is really easy to get started, but once you want to configure the build syste just a little bit, it’s time to eject the project. At this point it get’s confusing because many beginners cant handle the ejected code.</p> <h2 id="github-repository"> <a href="#github-repository" class="anchor-head"></a> GitHub Repository </h2> <p>If you don’t wann see my config files or read any explanation, just go ahead and fork / clone my GitHub Repository to start your own react journey.</p> <p><a href="https://github.com/scriptworld-git/reactStarter-WebpackHotMiddlewareExpressJs">GitHub Repo</a></p> <h2 id="starting-your-server"> <a href="#starting-your-server" class="anchor-head"></a> Starting your Server </h2> <p>The <a href="">NodeJs</a> server will compile the client via webpack and serve it.<br /> There is no need for a second console which is serving the bundle via webpack.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm start
</code></pre></div></div> <h2 id="packagejson"> <a href="#packagejson" class="anchor-head"></a> package.json </h2> <p><a href="https://github.com/scriptworld-git/reactStarter-WebpackHotMiddlewareExpressJs/blob/master/package.json">Click me to see the full file!</a></p> <p>This is the entry point of the project. Remember: the server will compile and serve the client.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server/index.js"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">start</code> script can be executed without the <code class="language-plaintext highlighter-rouge">run</code> parameter. We use <a href="http://nodemon.io">nodemon</a> to watch in our <code class="language-plaintext highlighter-rouge">server</code> directory for changes so the server is able to restart every time we change a file.<br /> There is no need to watch in our client directory, that’s going to be done by webpack.<br /> To enable our <code class="language-plaintext highlighter-rouge">.babelrc</code> file (ES6 support), we have to tell nodemon to execute the index.js with <code class="language-plaintext highlighter-rouge">babel-node</code>.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nodemon --watch server --exec babel-node -- server/index.js"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"echo </span><span class="se">\"</span><span class="s2">Error: no test specified</span><span class="se">\"</span><span class="s2"> &amp;&amp; exit 1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Normal dependencies.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"body-parser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.18.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"classnames"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.2.5"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.16.3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"history"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.7.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.12.7"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^16.3.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"react-dom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^16.3.2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"react-router"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.2.0"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"react-router-dom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.2.2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Build / development dependencies.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"babel-cli"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.26.0"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-core"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.26.3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^7.1.4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-plugin-react-html-attrs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.0"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-plugin-transform-class-properties"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-plugin-transform-decorators-legacy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.3.4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-preset-es2015"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-preset-react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"babel-preset-stage-0"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"nodemon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.17.4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"open"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.5"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"webpack"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.8.3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"webpack-cli"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"webpack-dev-middleware"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.1.3"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"webpack-hot-middleware"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.22.1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="webpackconfigjs"> <a href="#webpackconfigjs" class="anchor-head"></a> webpack.config.js </h2> <p><a href="https://github.com/scriptworld-git/reactStarter-WebpackHotMiddlewareExpressJs/blob/master/webpack.config.js">Click me to see the full file!</a></p> <p>First of all we have to define a variable so we can change the config file depending on <code class="language-plaintext highlighter-rouge">production</code> or <code class="language-plaintext highlighter-rouge">development</code> mode.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">dev</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div> <p>Sourc maps will make our <code class="language-plaintext highlighter-rouge">bundle.js</code> way bigger. By choosing <code class="language-plaintext highlighter-rouge">none</code> in production mode, we can reduce the bundled js file by 90%.<br /> Also the webpack <code class="language-plaintext highlighter-rouge">mode</code> will do some nice predefined steps for us like uglifying the code so it becomes even more reduced.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mode</span><span class="p">:</span> <span class="nx">dev</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">devtool</span><span class="p">:</span> <span class="nx">dev</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">inline-source-map</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span>
</code></pre></div></div> <p>In developement mode we have to add the <code class="language-plaintext highlighter-rouge">webpack-hot-middleware/client</code> to our entry so react is able to accept the hot-reload.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">entry</span><span class="p">:</span> <span class="nx">dev</span>
    <span class="p">?</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">webpack-hot-middleware/client</span><span class="dl">'</span><span class="p">,</span>
          <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">client/index.js</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">]</span>
    <span class="p">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">client/index.js</span><span class="dl">'</span><span class="p">)];</span>
</code></pre></div></div> <p>As our module loader we use <code class="language-plaintext highlighter-rouge">babel-loader</code> so webpack knows how to handle ES6 code.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">rules</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">jsx</span><span class="se">?</span><span class="sr">$/</span><span class="p">,</span>
            <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">babel-loader</span><span class="dl">'</span><span class="p">],</span>
            <span class="na">include</span><span class="p">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">client</span><span class="dl">'</span><span class="p">)]</span>
        <span class="p">}</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div> <p>It’s very important to set the <code class="language-plaintext highlighter-rouge">publicPath</code> to <code class="language-plaintext highlighter-rouge">/</code> because that is the path where express will server the bundle.js file.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">publicPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bundle.js</span><span class="dl">'</span>
<span class="p">}</span>
</code></pre></div></div> <p>We need to use these Modules to enable the Hot-Module-Replacement in development mode.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">plugins</span><span class="p">:</span> <span class="nx">dev</span>
    <span class="p">?</span> <span class="p">[</span>
          <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">NamedModulesPlugin</span><span class="p">(),</span>
          <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">HotModuleReplacementPlugin</span><span class="p">()</span>
      <span class="p">]</span>
    <span class="p">:</span> <span class="p">[];</span>
</code></pre></div></div> <h2 id="babelrc"> <a href="#babelrc" class="anchor-head"></a> .babelrc </h2> <p><a href="https://github.com/scriptworld-git/reactStarter-WebpackHotMiddlewareExpressJs/blob/master/.babelrc">Click me to see the file on GitHub!</a></p> <p>All the presets for our ES6 support are going to be set here.<br /> We also enable the new decorators to use <code class="language-plaintext highlighter-rouge">@decorator</code> later in our code.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"presets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"es2015"</span><span class="p">,</span><span class="w"> </span><span class="s2">"react"</span><span class="p">,</span><span class="w"> </span><span class="s2">"stage-0"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"transform-decorators-legacy"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"react-html-attrs"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transform-class-properties"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="react-indexjs"> <a href="#react-indexjs" class="anchor-head"></a> react index.js </h2> <p><a href="https://github.com/scriptworld-git/reactStarter-WebpackHotMiddlewareExpressJs/blob/master/client/index.js">Click me to see the full file!</a></p> <p>This code snippet needs to be added after the <code class="language-plaintext highlighter-rouge">render()</code> function in our react-app.<br /> It accepts hot-reload requests from the browser.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">hot</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">hot</span><span class="p">.</span><span class="nx">accept</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="express-indexjs"> <a href="#express-indexjs" class="anchor-head"></a> express index.js </h2> <p><a href="https://github.com/scriptworld-git/reactStarter-WebpackHotMiddlewareExpressJs/blob/master/server/index.js">Click me to see the full file!</a></p> <p>As before in our webpack config, we also have to define the <code class="language-plaintext highlighter-rouge">development</code> variable.<br /> After that we can import all modules needed for our hot-reload plugin.<br /> Even though we enabled ES6 code, it’s time to use the <code class="language-plaintext highlighter-rouge">require</code>, because <code class="language-plaintext highlighter-rouge">ìmport</code> statements can only be done at the top of the file.<br /> Since we wrap these up in the if statement, they are not at the top anymore.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">dev</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">dev</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">webpackDevMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack-dev-middleware</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">webpackHotMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack-hot-middleware</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../webpack.config</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>After setting up the express app we can use another middleware depending on the mode.<br /> We inject the <code class="language-plaintext highlighter-rouge">webpack-dev-middleware</code> so express will compile and serve the bundle.js file.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">dev</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
        <span class="nx">webpackDevMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">hot</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">noInfo</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">publicPath</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">publicPath</span>
        <span class="p">})</span>
    <span class="p">);</span>

    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">webpackHotMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div> <p>All set up! If you have any trouble getting this started, maybe so a fresh clone of the repository or feel free to contact me.</p> </div> </article> <!-- unnecessary file, however you can still use for comment section, e.g disqus --> <script src="https://utteranc.es/client.js" repo="breuerfelix/breuerfelix.github.io" issue-term="pathname" label="comment" theme="github-dark" crossorigin="anonymous" async ></script> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/blog/Nginx-Server-Blocks.html" > <div class="nav-arrow">Previous</div> <span class="post-title">Useful Nginx Server Blocks</span> </a> <a class="post-nav-item post-nav-next" href="/blog/System.exe-High-CPU.html"> <div class="nav-arrow">Next</div> <span class="post-title">system.exe at ~25% CPU fix</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2021</span> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
